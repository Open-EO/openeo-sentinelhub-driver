<!DOCTYPE html>
<html>  
<head>
    <title>GridLayer Test</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>

    <script>

function toClrVal(a) {
    return a < 0 ? 0 : a > 1 ? 255 : Math.round(255*a);
}

function clrPixel(ndvi) {
    return [1-ndvi, 1, 0.5, 1].map(toClrVal);
}

function recolor(tile) {
    const srcData = tile.originalImage;
    const ctx = tile.getContext('2d');
    const tgtData = ctx.getImageData(0, 0, tile.width, tile.height);
    for (var i = 0; i < tgtData.data.length; i += 4) {
        const pxClrs = clrPixel(tile.originalImage.data[i]/255*2 - 1);
        tgtData.data[i] = pxClrs[0];
        tgtData.data[i+1] = pxClrs[1];
        tgtData.data[i+2] = pxClrs[2];
        tgtData.data[i+3] = pxClrs[3];
    }
    ctx.putImageData(tgtData, 0, 0);
}

var map = new L.Map('map', {  center: [45, 15], zoom: 8});

var tiles = L.tileLayer.wms("http://localhost:8080/download/8b055750-da63-11e7-a7b4-717018423482/wcs", {
    'request': 'GetCoverage',
    'service': 'WCS',
    'coverage': 'CUSTOM',
    'format': 'image/png',
    'tileSize': 512,
    'minZoom' : 8
});
tiles.createTile = function(coords) {
  const tile = L.DomUtil.create('canvas', 'leaflet-tile');
  tile.width = tile.height = this.options.tileSize;

  const imageObj = new Image();
  imageObj.onload = function() {
        const ctx = tile.getContext('2d');
        ctx.drawImage(imageObj, 0, 0);
        tile.originalImage = ctx.getImageData(0, 0, tile.width, tile.height);
        recolor(tile);
  };
  imageObj.src = this.getTileUrl(coords);
  return tile;
}

L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
   attribution: 'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>'
}).addTo(map)
	
tiles.addTo(map)
    </script>
</body>
</html>